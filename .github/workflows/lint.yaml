---
name: Run linters

"on":
  - push

jobs:
  lint:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    steps:
      - name: Install nix
        uses: cachix/install-nix-action@v18

      - name: Check out repository code
        uses: actions/checkout@v3

      - name: Pull linters and set PATH
        run: |
          # shellcheck disable=SC2016
          # EVs must be expanded in a sub shell
          nix develop --accept-flake-config .#devShells.x86_64-linux.lint \
            --command bash -c 'echo PATH="$PATH" >> "$GITHUB_ENV"'

      - name: Lint GitHub Actions
        run: actionlint

      - name: Lint lua
        run: selene .

      - name: Lint nix (statix)
        run: statix check

      - name: Lint nix (nixpkgs-fmt)
        run: nixpkgs-fmt --check .
